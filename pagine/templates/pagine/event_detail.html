{% extends 'base.html' %}

{% block title %}RP | {{ event.title }}{% endblock title %}
{% block content %}
      {% if event.get_image %}
        <div class="row">
          <img src="{{ event.get_image.image.url }}" width="100%" alt="{{ event.get_image.image.description }}" />
        </div>
      {% endif %}
      <div class="row row-striped">
        <div class="col-md-2 text-right">
          <h1 class="display-4"><span class="badge badge-{{ event.get_badge_color }}">{{ event.date|date:"j" }}</span></h1>
          <a href="/calendario/{{ event.date|date:"Y/m" }}/"><h4>{{ event.date|date:"M-Y" }}</h4></a>
        </div>
        <div class="col-md-10">
          <h3 class="text-uppercase"><strong>{{ event.title }}</strong></h3>
          <ul class="list-inline">
            <li class="list-inline-item"><i class="fa fa-calendar-o" aria-hidden="true"></i> {{ event.date|date:"l" }}</li>
            <li class="list-inline-item"><i class="fa fa-clock-o" aria-hidden="true"></i> {{ event.date|date:"H:i" }}</li>
            <li class="list-inline-item">
              <i class="fa fa-location-arrow" aria-hidden="true"></i>
              <a href="/luoghi/{{ event.location.slug }}">{{ event.location.title }}</a>
            </li>
            {% if event.manager %}
            <li class="list-inline-item">
              <i class="fa fa-user" aria-hidden="true"></i>
              {% if user.is_authenticated %}
              <a href="/contacts/?recipient={{ event.manager_id }}">{{ event.manager }}</a>
              {% else %}
              {{ event.manager }}
              {% endif %}
            </li>
            {% endif %}
            {% if event.get_tags %}
              <li class="list-inline-item">
                <i class="fa fa-folder-open" aria-hidden="true"></i>
                {% for tag in event.get_tags %}
                  <a href="/calendario/?categoria={{ tag }}">{{ tag|upper }}</a>
                {% endfor %}
              </li>
            {% endif %}
          </ul>
          <p>{{ event.intro }}</p>
        </div>
      </div>
      <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8">
        {% if event.get_chronicle %}
          <div class="row">
            <h4><strong>Cronaca</strong></h4>
          </div>
          <div class="row">
            {{ event.chronicle|safe }}
          </div>
          <hr class="mb-4">
          {% if user.is_authenticated %}
            <div class="row">
              <h4 id="upload-anchor"><strong>Contributi</strong></h4>
            </div>
            <div class="row">
              <a href="/calendario/contributi/?event_id={{ event.id }}">
              Aggiungi un contributo</a>
            </div>
            <hr class="mb-4">
            {% if event.get_uploads %}
              {% for upload in event.get_uploads %}
              <div class="row">
                <p>{{ upload.body }}</p>
                {% if upload.image %}<img src="{{ upload.image.url }}" width="100%" alt="" />{% endif %}
              </div>
              <div class="row">
                <em>{% if upload.user.member.avatar %}{{ upload.user.member.get_thumb }}{% endif %}
                {{ upload.user.get_full_name_reverse }}, caricato il {{ upload.date|date:"d M Y"}}</em>
              </div>
              <hr class="mb-4">
              {% endfor %}
            {% endif %}
          {% else %}
            <div class="row">
              Esegui il <a href="/admin/login/?next={{ request.get_full_path }}">login</a> se vuoi aggiungere un contributo
            </div>
            <hr class="mb-4">
          {% endif %}
        {% else %}
          {% if event.get_upgrades %}
            {% for upgrade in event.get_upgrades %}
            <div class="row">
              <h4><strong>Aggiornamento del {{ upgrade.date|date:"d M Y" }} - {{ upgrade.title }}</strong></h4>
              {{ upgrade.body|safe }}
            </div>
            <hr class="mb-4">
            {% endfor %}
            <div class="row">
            <h4><strong>Articolo originale</strong></h4></div>
          {% endif %}
          <div class="row">
            {{ event.body|safe }}
          </div>
        {% endif %}
        </div>
      </div>
{% endblock content %}
